var a=['startsWith','http','localhost','split','http://','length','setProxy','session','log','apply','startHarvesting','spawnCaptchaWindow','all','map','StartHarvestCaptcha','suspendHarvesting','SUSPEND','forEach','StopHarvestCaptcha','stopHarvesting','getNextCaptcha','next','isRunning','[DEBUG]:\x20Starting\x20captcha\x20server','captchaServerManager','setUserAgent','*/*','push','http://127.0.0.1:','port','.google.com,.gstatic.com','loadURL','http://checkout.shopify.com','env','[DEBUG]:\x20Window\x20was\x20opened,\x20id\x20=\x20','once','did-finish-load','[DEBUG]:\x20Window\x20was\x20closed,\x20id\x20=\x20','filter','stop','destroyed','spawnYoutubeWindow','ready-to-show','NEBULA_ENV_SHOW_DEVTOOLS','openDevTools','show','removeListener','get','[DEBUG]:\x20Closing\x20all\x20captcha\x20windows...','flushStorageData','clearStorageData','[DEBUG]:\x20Resuming\x20harvesters...','insert','focus','find','exports','electron','./env','../common/constants','idle','suspend','active','_context','_captchaWindows','_youtubeWindows','_tokenQueue','_checkTokenIntervalId','_harvestStatus','IDLE','validateSender','bind','addExpirationFilter','_handleTokenExpirationUpdate','ipc','RequestLaunchYoutube','_onRequestLaunchYoutube','RequestEndSession','_onRequestEndSession','RequestSaveCaptchaProxy','_onRequestSaveCaptchaProxy','HarvestCaptcha','_onHarvestToken','RequestRefresh','sender','RequestCloseAllCaptchaWindows','closeAllCaptchaWindows','RequestCloseWindow','webContents','close','isDevelopment','viewCwmQueueStats','send','debug','Queue\x20Line\x20Length:\x20','lineLength',',\x20Backlog\x20Length:\x20','backlogLength','viewCwmHarvestState','State:\x20'];(function(c,d){var e=function(f){while(--f){c['push'](c['shift']());}};e(++d);}(a,0x1c4));var b=function(c,d){c=c-0x0;var e=a[c];return e;};const {session:Session}=require(b('0x0'));const {differenceInSeconds}=require('date-fns');const {createCaptchaWindow,createYouTubeWindow,urls}=require('./windows');const nebulaEnv=require(b('0x1'));const IPCKeys=require(b('0x2'));const AsyncQueue=require('../common/classes/asyncQueue');nebulaEnv['setUpEnvironment']();const HARVEST_STATE={'IDLE':b('0x3'),'SUSPEND':b('0x4'),'ACTIVE':b('0x5')};const MAX_HARVEST_CAPTCHA_COUNT=0x5;class CaptchaWindowManager{constructor(c){this[b('0x6')]=c;this[b('0x7')]=[];this[b('0x8')]={};this[b('0x9')]=new AsyncQueue();this[b('0xa')]=null;this[b('0xb')]={'state':HARVEST_STATE[b('0xc')],'runnerId':null,'siteKey':null};this['validateSender']=this[b('0xd')][b('0xe')](this);this[b('0x9')][b('0xf')](({timestamp})=>differenceInSeconds(new Date(),timestamp)<=0x6e,0x3e8,this[b('0x10')],this);c[b('0x11')]['on'](IPCKeys[b('0x12')],this[b('0xd')](this[b('0x13')]));c['ipc']['on'](IPCKeys[b('0x14')],this[b('0xd')](this[b('0x15')]));c[b('0x11')]['on'](IPCKeys[b('0x16')],this['validateSender'](this[b('0x17')]));c[b('0x11')]['on'](IPCKeys[b('0x18')],this[b('0xd')](this[b('0x19')]));c[b('0x11')]['on'](IPCKeys[b('0x1a')],this[b('0xd')](d=>d[b('0x1b')]['reload']()));c[b('0x11')]['on'](IPCKeys[b('0x1c')],()=>{this[b('0x1d')]();});c['ipc']['on'](IPCKeys[b('0x1e')],this[b('0xd')](e=>{this['_captchaWindows']['find'](f=>f[b('0x1f')]['id']===e[b('0x1b')]['id'])[b('0x20')]();}));if(nebulaEnv[b('0x21')]()){c['ipc']['on']('debug',(g,h)=>{switch(h){case b('0x22'):{g[b('0x1b')][b('0x23')](b('0x24'),h,b('0x25')+this[b('0x9')][b('0x26')]+b('0x27')+this[b('0x9')][b('0x28')]);break;}case b('0x29'):{g[b('0x1b')][b('0x23')]('debug',h,b('0x2a')+this[b('0xb')]['state']);break;}default:{break;}}});}}static['formatProxy'](i){if(!i||i[b('0x2b')](b('0x2c'))||i===b('0x2d')){return i;}const j=i[b('0x2e')](':');if(j['length']===0x2){return b('0x2f')+j[0x0]+':'+j[0x1];}if(j[b('0x30')]===0x4){return b('0x2f')+j[0x2]+':'+j[0x3]+'@'+j[0x0]+':'+j[0x1];}return null;}static[b('0x31')](k,{proxyRules,proxyBypassRules=''}){if(k){k['webContents'][b('0x32')][b('0x31')]({'proxyRules':proxyRules,'proxyBypassRules':proxyBypassRules},()=>{k[b('0x1f')][b('0x32')]['resolveProxy']('https://google.com',m=>{console[b('0x33')]('[DEBUG]:\x20Session\x20proxy\x20set\x20to:\x20%j',m);});});}}[b('0xd')](n){return(o,...p)=>{const q=this['_captchaWindows']['find'](r=>r[b('0x1f')]['id']===o[b('0x1b')]['id']);if(q&&!q['isDestroyed']()){n[b('0x34')](this,[o,...p]);}};}async[b('0x35')](s,t){this[b('0xb')]={'state':HARVEST_STATE['ACTIVE'],'runnerId':s,'siteKey':t};if(this[b('0x7')][b('0x30')]===0x0){this[b('0x36')]();}else{await Promise[b('0x37')](this['_captchaWindows'][b('0x38')](async(u,v)=>{await new Promise(w=>setTimeout(w,v*0xfa));u[b('0x1f')]['send'](IPCKeys[b('0x39')],s,t);}));}}[b('0x3a')](x,y){this[b('0xb')]={'state':HARVEST_STATE[b('0x3b')],'runnerId':x,'siteKey':y};this[b('0x7')][b('0x3c')](z=>{z[b('0x1f')]['send'](IPCKeys[b('0x3d')],x,y);});}[b('0x3e')](A,B){this[b('0xb')]={'state':HARVEST_STATE[b('0xc')],'runnerId':null,'siteKey':null};this[b('0x7')][b('0x3c')](C=>{C[b('0x1f')][b('0x23')](IPCKeys[b('0x3d')],A,B);});}[b('0x3f')](){return this[b('0x9')][b('0x40')]();}[b('0x36')](D={}){if(this['_captchaWindows'][b('0x30')]>=0x5){return null;}if(!this[b('0x6')]['captchaServerManager'][b('0x41')]){console['log'](b('0x42'));this['_context'][b('0x43')]['start']();}const E=Session['defaultSession'];const F=createCaptchaWindow(D,{'session':E});F[b('0x1f')][b('0x32')][b('0x44')]('Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_14_4)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/72.0.3626.121\x20Safari/537.36',b('0x45'));const G=F['id'];const H=F[b('0x1f')]['id'];this[b('0x7')][b('0x46')](F);CaptchaWindowManager[b('0x31')](F,{'proxyRules':b('0x47')+this[b('0x6')][b('0x43')][b('0x48')],'proxyBypassRules':b('0x49')});F[b('0x4a')](b('0x4b'));F['on']('ready-to-show',()=>{if(nebulaEnv[b('0x21')]()||process[b('0x4c')]['NEBULA_ENV_SHOW_DEVTOOLS']){console['log'](b('0x4d')+G);F['webContents']['openDevTools']();}F['show']();});F['webContents'][b('0x4e')](b('0x4f'),()=>{CaptchaWindowManager['setProxy'](F,'');const {state,runnerId,siteKey}=this[b('0xb')];if(state===HARVEST_STATE['ACTIVE']){F[b('0x1f')]['send'](IPCKeys['StartHarvestCaptcha'],runnerId,siteKey);}});const I=()=>{if(nebulaEnv[b('0x21')]()){console['log'](b('0x50')+G);}this[b('0x7')]=this[b('0x7')][b('0x51')](J=>J['id']!==G);const K=this[b('0x8')][H];if(K){delete this[b('0x8')][H];K[b('0x20')]();}if(this[b('0x7')][b('0x30')]===0x0){console[b('0x33')]('[DEBUG]:\x20Stopping\x20captcha\x20server...');this['_context'][b('0x43')][b('0x52')]();}};F[b('0x1f')]['on'](b('0x53'),I);F['on']('close',()=>{F[b('0x1f')]['removeListener'](b('0x53'),I);I();});return F;}[b('0x54')](L,M){const N=createYouTubeWindow(null,{'session':M});const O=N['id'];this[b('0x8')][L]=N;N['on'](b('0x55'),()=>{if(nebulaEnv[b('0x21')]()||process['env'][b('0x56')]){console[b('0x33')](b('0x4d')+O);N[b('0x1f')][b('0x57')]();}N[b('0x58')]();});const P=()=>{if(nebulaEnv[b('0x21')]()){console[b('0x33')]('[DEBUG]:\x20Window\x20was\x20closed,\x20id\x20=\x20'+O);}if(this[b('0x8')][L]){delete this[b('0x8')][L];}};N[b('0x1f')]['on'](b('0x53'),P);N['on'](b('0x20'),()=>{N[b('0x1f')][b('0x59')](b('0x53'),P);P();});N[b('0x4a')](urls[b('0x5a')]('gmail'));return N;}[b('0x1d')](){if(this[b('0x7')][b('0x30')]===0x0){return;}console['log'](b('0x5b'));this['_captchaWindows']['forEach'](Q=>{Q[b('0x20')]();});}['_onRequestEndSession'](R){R[b('0x1b')][b('0x32')][b('0x5c')]();R[b('0x1b')][b('0x32')][b('0x5d')]();R['sender']['session']['clearCache'](()=>{});const S=this[b('0x8')][R[b('0x1b')]['id']];if(S){S['close']();}}['_handleTokenExpirationUpdate'](){const {state,runnerId,siteKey}=this['_harvestStatus'];if(this[b('0x9')][b('0x28')]===0x0&&state===HARVEST_STATE[b('0x3b')]){console[b('0x33')](b('0x5e'));this['startHarvesting'](runnerId,siteKey);}}[b('0x19')](T,U,V,W='unattached',X=b('0x4b')){this[b('0x9')][b('0x5f')]({'token':V,'siteKey':W,'host':X,'timestamp':new Date()});if(this['_tokenQueue'][b('0x28')]>=MAX_HARVEST_CAPTCHA_COUNT){console[b('0x33')]('[DEBUG]:\x20Token\x20Queue\x20is\x20greater\x20than\x20max,\x20suspending...');this[b('0x3a')](U,W);}}[b('0x13')](Y){const {id,session}=Y[b('0x1b')];let Z=this['_youtubeWindows'][id];if(!Z){Z=this['spawnYoutubeWindow'](id,session);}Z[b('0x60')]();}[b('0x17')](a0,a1,a2){const a3=this[b('0x7')][b('0x61')](a4=>a4['id']===a1);CaptchaWindowManager[b('0x31')](a3,{'proxyRules':CaptchaWindowManager['formatProxy'](a2)});}}module[b('0x62')]=CaptchaWindowManager;