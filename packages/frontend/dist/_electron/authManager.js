var a=['now','env','NEBULA_API_URL','/auth/token','POST','stringify','refresh','refreshToken','json','log','clearSession','getSession','application/json','Bearer\x20','status','[ERROR]:\x20Unable\x20to\x20Delete:\x20','delete','createSession','key','[ERROR]:\x20Unable\x20to\x20create\x20auth\x20token:\x20','error','_onAuthRequestActivate','_context','_windowManager','_auth','transitionToDeauthedState','transitiontoAuthedState','send','Unable\x20to\x20invalidate','exports','electron-store','node-fetch','./env','../common/constants','_store','apply','ipc','AuthRequestDeactivate','_onAuthRequestDeactivate','AuthRequestStatus','_onAuthRequestStatus','Store','isDevelopment','DEVREFRESH','session','parse','expiry'];(function(c,d){var e=function(f){while(--f){c['push'](c['shift']());}};e(++d);}(a,0x109));var b=function(c,d){c=c-0x0;var e=a[c];return e;};const Store=require(b('0x0'));const fetch=require(b('0x1'));const nebulaEnv=require(b('0x2'));const IPCKeys=require(b('0x3'));nebulaEnv['setUpEnvironment']();class AuthManager{constructor(c){this['_context']=c;this[b('0x4')]=new Store();const d=e=>{let f=![];return async(...g)=>{if(!f){f=!![];await e[b('0x5')](this,g);f=![];}};};c['ipc']['on'](IPCKeys['AuthRequestActivate'],d(this['_onAuthRequestActivate']));c[b('0x6')]['on'](IPCKeys[b('0x7')],d(this[b('0x8')]));c['ipc']['on'](IPCKeys[b('0x9')],d(this[b('0xa')]));}get[b('0xb')](){if(nebulaEnv[b('0xc')]()){return this[b('0x4')];}return null;}async['getSession'](){if(nebulaEnv[b('0xc')]()){return{'accessToken':'DEVACCESS','refreshToken':b('0xd'),'expiry':null};}let h=this['_store']['get'](b('0xe'));if(h){h=JSON[b('0xf')](h);if(h[b('0x10')]===null||h[b('0x10')]>Date[b('0x11')]()/0x3e8){return h;}const i=await fetch(process[b('0x12')][b('0x13')]+b('0x14'),{'method':b('0x15'),'headers':{'Accept':'application/json','Content-Type':'application/json'},'body':JSON[b('0x16')]({'grant_type':b('0x17'),'token':h[b('0x18')]})});if(i['ok']){const j=await i[b('0x19')]();const {accessToken,refreshToken,expiry}=j;this[b('0x4')]['set']('session',JSON[b('0x16')]({'accessToken':accessToken,'refreshToken':refreshToken,'expiry':expiry}));return{'accessToken':accessToken,'refreshToken':refreshToken,'expiry':expiry};}const {error}=await i[b('0x19')]();console[b('0x1a')]('[ERROR]\x20Unable\x20to\x20perform\x20refresh:\x20',error);return null;}return null;}async[b('0x1b')](){if(nebulaEnv['isDevelopment']()){this[b('0x4')]['delete'](b('0xe'));return!![];}const k=await this[b('0x1c')]();if(k){const l=await fetch(process['env'][b('0x13')]+'/auth',{'method':'DELETE','headers':{'Accept':b('0x1d'),'Authorization':b('0x1e')+k['accessToken'],'Content-Type':b('0x1d')}});if(!l['ok']&&l[b('0x1f')]!==0x193){const {error}=await l['json']();console[b('0x1a')](b('0x20'),error);return![];}}this['_store'][b('0x21')](b('0xe'));return!![];}async[b('0x22')](m){if(nebulaEnv[b('0xc')]()){return{'accessToken':'DEVACCESS','refreshToken':b('0xd'),'expiry':null};}const n=await this[b('0x1c')]();if(n){return n;}const o=await fetch(process[b('0x12')][b('0x13')]+b('0x14'),{'method':b('0x15'),'headers':{'Accept':b('0x1d'),'Content-Type':b('0x1d')},'body':JSON[b('0x16')]({'grant_type':b('0x23'),'key':m})});if(o['ok']){const p=await o[b('0x19')]();const {accessToken,refreshToken,expiry}=p;this['_store']['set'](b('0xe'),JSON[b('0x16')]({'accessToken':accessToken,'refreshToken':refreshToken,'expiry':expiry}));return{'accessToken':accessToken,'refreshToken':refreshToken,'expiry':expiry};}const q=await o[b('0x19')]();console[b('0x1a')](b('0x24'),q);return{'errors':q[b('0x25')]};}async[b('0x26')](r,s){let t=await this[b('0x1c')]();if(!t){t=await this['createSession'](s);}const u=this[b('0x27')][b('0x28')];if(!t||t&&t['errors']){if(!u[b('0x29')]){u[b('0x2a')]();}}else{u[b('0x2b')]();}}async[b('0x8')](v){const w=await this['clearSession']();if(!w){v['sender'][b('0x2c')](b('0x25'),b('0x2d'));return;}this[b('0x27')][b('0x28')][b('0x2a')]();}async['_onAuthRequestStatus'](){return!!(await this[b('0x1c')]());}}module[b('0x2e')]=AuthManager;